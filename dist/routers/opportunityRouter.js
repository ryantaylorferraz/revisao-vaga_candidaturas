"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.OpportunityRouter = void 0;
const express_1 = require("express");
const opportunityController_1 = require("../controllers/opportunityController");
const applicationRouter_1 = require("./applicationRouter");
const validBody_middleware_1 = require("../middlewares/validBody.middleware");
const opportunitySchema_1 = require("../schemas/opportunitySchema");
const isOpportunityIdValid_middleware_1 = require("../middlewares/isOpportunityIdValid.middleware");
const tsyringe_1 = require("tsyringe");
const opportunityService_1 = require("../services/opportunityService");
const validateToken_middleware_1 = require("../middlewares/validateToken.middleware");
const isOpportunityOwner_middleware_1 = require("../middlewares/isOpportunityOwner.middleware");
exports.OpportunityRouter = (0, express_1.Router)();
tsyringe_1.container.registerSingleton("OpportunityService", opportunityService_1.OpportunityService);
const opportunityController = tsyringe_1.container.resolve(opportunityController_1.OpportunityController);
exports.OpportunityRouter.post("/", validateToken_middleware_1.ValidateToken.execute, validBody_middleware_1.validBody.execute(opportunitySchema_1.opportunityCreateSchema), (req, res) => opportunityController.create(req, res));
exports.OpportunityRouter.get("/", (req, res) => opportunityController.findMany(req, res));
exports.OpportunityRouter.get("/user", validateToken_middleware_1.ValidateToken.execute, (req, res) => opportunityController.findMany(req, res));
exports.OpportunityRouter.use("/:id", isOpportunityIdValid_middleware_1.IsOpportunityIdValid.execute);
exports.OpportunityRouter.get("/:id", validateToken_middleware_1.ValidateToken.execute, isOpportunityOwner_middleware_1.IsOpportunityOwner.execute, (req, res) => opportunityController.findOne(req, res));
exports.OpportunityRouter.patch("/:id", validateToken_middleware_1.ValidateToken.execute, isOpportunityOwner_middleware_1.IsOpportunityOwner.execute, (req, res) => opportunityController.update(req, res));
exports.OpportunityRouter.delete("/:id", validateToken_middleware_1.ValidateToken.execute, isOpportunityOwner_middleware_1.IsOpportunityOwner.execute, (req, res) => opportunityController.delete(req, res));
exports.OpportunityRouter.use("/", applicationRouter_1.ApplicationRouter);
